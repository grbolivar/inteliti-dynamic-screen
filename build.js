function initEta(e){let t=6e4*e.updateEveryMins;fetchEta(e),window.setInterval((t=>fetchEta(e)),t)}function fetchEta({stopIds:e}){let t=e.map(fetchStop);Promise.all(t).then((e=>e?.flat())).then(checkUnits)}function fetchStop(e){return fetch(endpointStop.replace("%ID%",e)).then((e=>e.json())).then((e=>JSON.parse(e))).then((e=>e?.at(1)))}function checkUnits(e=[]){if(e.length<=0)return void noUnitsAvailable();e.sort(((e,t)=>parseInt(e.ETASeconds)-parseInt(t.ETASeconds)));let t=e[0];updateInfoPanel(t.ETASeconds,t.ShortName);let n=[];e.forEach((e=>{n.find((({UnitID:t})=>e.UnitID==t))||n.push(e)})),n.forEach(addVehicleToDOMAndMoveIt)}function updateInfoPanel(e,t){let n=Math.floor(e/60),o=n<=1,a=document.getElementById("minutes-eta"),l=document.getElementById("text-eta"),i=document.getElementById("next-unit");o?(a.style.display="none",l.innerHTML="The Shuttle</span><br/><span>is in the Stop",l.classList.add("TrolleyAtStop")):(a.style.display="block",a.innerHTML=`${n} mins`,l.innerHTML="Until Next Arrival",l.classList.remove("TrolleyAtStop")),i.innerHTML=`UNIT ${t}`}function addVehicleToDOMAndMoveIt({UnitID:e,ShortName:t}){let n=document.getElementById(`shuttle-${e}`);n||(n=addVehicleToDOM(e,t)),moveVehicle(e,n)}function addVehicleToDOM(e,t){let n=document.createElement("DIV");return n.id=`shuttle-${e}`,n.classList.add("shuttle-icon-container"),n.innerHTML=`<img src="./res/images/ShuttleIcon.svg" /><span>${t}</span>`,document.getElementById("map-container").appendChild(n),n}function moveVehicle(e,t){fetch(endpointShuttle.replace("%ID%",e)).then((e=>e.json())).then((e=>JSON.parse(e))).then((e=>e?.at(0))).then((e=>parseInt(e?.RealStopId||0))).then((e=>moveVehicleByID(e,t)))}function moveVehicleByID(e,t){switch(!0){case TowardsIntracoastalMallNorth2South.includes(e):t.style.right="170px",t.style.top="810px";break;case TowardsIntracoastalMallSouth2North.includes(e):t.style.right="240px",t.style.top="1000px";break;case IntracoastalMall.includes(e):t.style.right="340px",t.style.top="900px";break;case GovtCenter.includes(e):t.style.right="20px",t.style.top="660px";break;case PelicanCommunityPark.includes(e):t.style.right="200px",t.style.top="600px";break;case AventuraMall.includes(e):t.style.right="450px",t.style.top="420px";break;case GoldenShores.includes(e):t.style.right="170px",t.style.top="480px";break;case Publix.includes(e):t.style.right="150px",t.style.top="520px";break;default:t.style.right="20px",t.style.top="350px"}}function noUnitsAvailable(){let e=document.getElementById("minutes-eta"),t=document.getElementById("text-eta"),n=document.getElementById("next-unit");e.innerHTML="Closed",t.innerHTML="Shuttle Service is closed",n.innerHTML="",removeAllVehiclesFromDOM()}function removeAllVehiclesFromDOM(){document.getElementsByClassName("shuttle-icon-container")?.forEach((e=>e.remove()))}const endpointStop="https://publictransportation.tsomobile.com/wcf/PubTrans/GetModuleInfoPublic?Key=STOPINFO_WITHOVERLAPS&id=%ID%&f1=31344&lan=en&_=1684446499883",endpointShuttle="https://publictransportation.tsomobile.com/wcf/PubTrans/GetModuleInfoPublic?Key=GET_UNIT_NEXTSTOP&id=%ID%&f1=31344",TowardsIntracoastalMallNorth2South=[893643,883291,893644,893645,893646,893647,893839,893841,893842,893843,883331,1123175,893845,893846,893847,1140614,893848,893849],TowardsIntracoastalMallSouth2North=[893850,893890,1451920,914322,893851,893852,893853,893854,896443,893861,883296,893888,893889,883295],IntracoastalMall=[883332,893891],GovtCenter=[893892,893893,893894,914323,893895,893896,893897,1123176,893899,883299,883300,893910,893911],PelicanCommunityPark=[897618],AventuraMall=[893913,893916,896933,896934,893916,893919,893920,883335,893930,896935,893929],GoldenShores=[893838,893928,893636],Publix=[893637,893638,893639,893641,883290,914324,914321];let APP_CONFIG={};function initApp(e="./config.json"){fetch(e).then((e=>e.json())).then((e=>APP_CONFIG=e)).then((e=>{initWeather(e.weather),initEta(e.eta),initMeta(e)})),initClock()}function initClock(){window.setInterval(updateClock,6e4)}function updateClock(){let e=document.getElementById("time"),t=moment().format("hh:mm A");e.innerHTML=t}function initMeta({routeName:e}){document.getElementById("main-route-stop").innerHTML=e}function initWeather(e){let t=6e4*e.updateEveryMins;fetchWeather(e),window.setInterval((t=>fetchWeather(e)),t)}function fetchWeather({apiKey:e,lat:t,lon:n,units:o}){try{fetch(`https://api.openweathermap.org/data/2.5/onecall?lat=${t}&lon=${n}&units=${o}&appid=${e}`).then((e=>e.json())).then((e=>updateWeather(e.hourly.slice(0,6))))}catch(e){l(e)}}function updateWeather(e){for(let t=0;t<e.length;t++){let n=document.getElementById("weather"+t),o=moment.unix(e[t].dt),a=isDayFunction(o),l=weatherCode2text(e[t].weather[0].id,a),i=Math.round(e[t].temp),s=0==t?"Now":o.format("HH:mm");n.innerHTML="<span>"+s+'</span><span><i class="wi wi-'+l+'"></i></span><span>'+i+"ยบ</span>"}}function isDayFunction(e){const t=moment("06:00:00","HH:mm:ss"),n=moment("17:00:00","HH:mm:ss");return e.isBetween(t,n)}function weatherCode2text(e,t){let n="";return e<300?n="thunderstorm":e<400?n="sprinkle":e<600?n="rain":e<700?n="snow":e<800?n="fog":800==e&&t?n="day-sunny":800!=e||t?801==e&&t?n="day-cloudy":801==e&&t?n="night-partly-cloudy":e<900&&(n="cloudy"):n="night-clear",n}